# Overview

This webpage is built on the game data in [RAWG](https://rawg.io/) website and uses [Chakra UI (2.10)](https://v2.chakra-ui.com/getting-started) as component library. It uses Grid layout to build overall structure. To fit different screen size, default responsive style is applied in the Grid.

The webpage can be divided into three parts: NavBar, Aside and Main.

## 1. NavBar

NavBar contains three elements: icon, search bar and mode switch.

Icon is imported as a variable rather than using absolute paths.

Mode switch uses Chakra's Switch component and useColorMode hook to achieve mode switch. To set the default theme, a theme.ts file is created and 'dark' is set as the initialColorMode. The theme can also be characterized using tools mentioned in [Default theme](https://v2.chakra-ui.com/docs/styled-system/theme), such as [Smart swatch](https://smart-swatch.netlify.app/). 

Search bar uses an InputLeftElement to show the search icon, and a useRef hook to get search input. It gives a prop called onSearch to the NavBar and finally to the App component for sending a new query request to the server.

## 2. Sidebar

Sidebar is wrapped inside a Show component, so in mobile devices, this area is hidden.

Sidebar's content is in Genrelist component, which includes a Heading and a List. Heading is a pure text area. The content of List is generated by mapping a genre list into ListItem. Each genre name is designed to be a Button because a new query request will be sent to the server if a genre is clicked.

### 2.1 Custom data hook

To get data from the server, a custom hook, useGenres, is used. To improve code reusability, a general data hook, useData is created. UseData requires three inputs:

1. endpoint: a string, like '/games' or '/genres'
2. requestConfig: optional, used when getting games
3. dependencies: optional, used when getting games

And it returns three outputs:

1. data: the data obtained from server
2. error: if url doesn't exist or other error happens
3. isLoading: a boolean represents whether data is still loading

UseData contains two parts:

1. three state hooks, each corresponding to one returned output
2. an effect hook, which contains a callback function and a dependency array. The callback function can get and set data, handle error, set loading status. It also contains a clean-up function in case the user cancels the request before data returns.

To hide the specific url from components, an api-client.ts file is created, which uses axios to create an AxiosInstance using the base URL and a key.  

Originally, useGenres first defines a Genre interface, then calls useData to create a new data hook.

### 2.2 Ship static data

Since genre categories rarely change, it is reasonable to download them and use it locally to improve network performance. So, in data folder, a genres.ts file is created to store all genres, and useGenres hook uses local data rather than requesting server.

## 3. Main

Main area takes up the majority of this webpage. It contains four parts: game heading, platform selector, sort selector and game grid.

### 3.1 GameQuery interface and state

This app needs to send different requests to the server, a request may contain following parameters: genre, platform, sort order and search text. In order to integrate all parameters into one object, a GameQuery interface is created, which has four corresponding properties. At the top level of App component, a state is defined to represent current game query. This query is then modified when search input, genre list or the two selectors change.

### 3.2 Game heading

Game heading is a component that takes a gameQuery object as property and returns the chosen platform and genre of current query.

### 3.3 Platform selector

This selector is a Menu object which contains a MenuButton and MenuList. The menu list is created using platform data. Similar to genre list, platform categories are rarely changed. So, the list of platforms is downloaded from server and used locally.

This component requires two parameters:

1. onSelectedPlatform. It is a function that takes a Platform object as input and return void. It is used to change the game query in App component and trigger a new query request.

2. SelectedPlatform. It is a string representing chosen platform. It is used to show chosen platform's name in the MenuButton.

### 3.4 Sort selector

The structure of sort selector is the same with platform selector. It also contains a MenuButton and a MenuList and requires a function and a string as input parameters. The difference lies in showing sort order.

In [API document](https://api.rawg.io/docs/#operation/games_list), it stipulates available fileds of ordering and a hyphen(-) in front of a string to reverse the sort order. For example, '-released' sorts the games from the latest to oldest. Naturally, reverse order is needed when the sort order is based on release date, popularity, average rating and date added. So, a sortOrders array is created to store the actual fields passed to the server (value) and its meaning (label). When finding the current order, the value is used; when showing the sort order, the label is used.

### 3.5 Game grid

Game grid takes a game query as parameter, and fetches game data to render the main part of this web page. To create a responsive design, a SimpleGrid element is used and different number of columns is set according to the screen size. It contains three components.

1. GameCardContainer. This component is created to set the size of GameCard and GameCardSkelton.

2. GameCardSkeleton. This component is rendered when the page is loading and shows a default picture to occupy a GameCard's position.

3. GameCard. This component shows all information about one game object. It contains an image of the game, a platform icon list, a critic score, game name and a emoji.

#### 3.5.1 Game image

Originally, the server returns an image of high quality. But this web page doesn't need to show a large picture. Thus, a crop function is created to crop the origin image to a smaller size to reduce the size of data.

#### 3.5.2 Platform icon list

This component takes a Platform array as parameters. First, all platform icons are imported from react-icons library. Then, an iconMap is created to map platform slug to the name of the icon in the library. In this way, when mapping each platform to an icon, the correct icon can be chosen.

#### 3.5.3 Critic score

This component takes a score as parameter and returns a Badge element. The color of the Badge is chosen according to the score.

#### 3.5.4 Emoji

This component takes a rating as parameters. An emojiMap is created to map each score to an emoji.

## 4. Further improvements

### 4.1 Prop drilling

An identical prop is passed from SearchInput to NavBar and then to App. When component tree gets deeper or wider, prop drilling can become messy and hard to manage.

Solution 1: For globally shared values, we can use React Context API. It is clean, no prop drilling and easy to expand. But not great for frequently updating values.

Solution 2: For large apps, use state management libraries like Zustand or Redux.

### 4.2 Unable to undo selection

In current design, when a genre/platform/order sequence is clicked, a query request is sent to the server and new data is shown. But if the user wants to cancel selecting a genre/platform, refreshing page is the only feasible way. There should be a button to undo this kind of selection and retrieve all categories of data.
